{% extends "base.html" %}

{% block title %}My Applications{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto py-10">
    <h1 class="text-3xl font-bold mb-6 text-slate-800">My Applications</h1>

    <form method="get" class="mb-4 flex items-center gap-3 text-sm">
        <label for="sort" class="text-slate-600">Sort by:</label>
        <select name="sort" id="sort"
                class="rounded-md border border-slate-200 px-2 py-1">
            <option value="recent" {% if sort == 'recent' %}selected{% endif %}>
                Most recent
            </option>
            <option value="status" {% if sort == 'status' %}selected{% endif %}>
                Status
            </option>
        </select>
        <button class="px-3 py-1 rounded-md bg-blue-600 text-white">
            Apply
        </button>
    </form>

    {% if applications %}
        <div class="bg-white shadow-md rounded-lg overflow-hidden border border-slate-200">
            <table class="w-full text-left border-collapse">
                <thead class="bg-slate-50 border-b border-slate-200 text-slate-700">
                    <tr>
                        <th class="px-6 py-3 font-semibold text-sm">Job Title</th>
                        <th class="px-6 py-3 font-semibold text-sm">Company</th>
                        <th class="px-6 py-3 font-semibold text-sm">Applied On</th>
                        <th class="px-6 py-3 font-semibold text-sm">Status</th>
                        <th class="px-6 py-3 font-semibold text-sm">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-100">
                    {% for app in applications %}
                    <tr class="hover:bg-slate-50 transition">
                        <td class="px-6 py-4 text-slate-900 font-medium">
                            {{ app.job.title }}
                        </td>
                        <td class="px-6 py-4 text-slate-600">
                            {{ app.job.company }}
                        </td>
                        <td class="px-6 py-4 text-slate-600 text-sm">
                            {{ app.applied_at|date:"M d, Y" }}
                        </td>
                        <td class="px-6 py-4">
                            <span class="inline-flex px-2 py-1 rounded-full text-xs font-medium
                                {% if app.status == 'Applied' %}bg-blue-100 text-blue-700
                                {% elif app.status == 'Under Review' %}bg-sky-100 text-sky-700
                                {% elif app.status == 'Shortlisted' %}bg-purple-100 text-purple-700
                                {% elif app.status == 'Interview' %}bg-orange-100 text-orange-700
                                {% elif app.status == 'Hired' %}bg-green-100 text-green-700
                                {% elif app.status == 'Rejected' %}bg-red-100 text-red-700
                                {% elif app.status == 'Withdrawn' %}bg-slate-100 text-slate-600
                                {% else %}bg-gray-100 text-gray-700{% endif %}">
                                {{ app.status }}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-sm">
                            <div class="flex gap-3 items-center">
                                <a href="{% url 'job_detail' app.job.id %}" class="text-blue-600 hover:underline">
                                    View Job
                                </a>

                                {% if app.status not in 'Rejected,Hired,Withdrawn' %}
                                    <a href="{% url 'edit_application' app.id %}" class="text-slate-600 hover:underline">
                                        Edit
                                    </a>
                                    <form method="post" action="{% url 'withdraw_application' app.id %}" style="display:inline;">
                                        {% csrf_token %}
                                        <button type="submit" class="text-red-600 hover:underline bg-none border-none cursor-pointer" onclick="return confirm('Withdraw this application?')">
                                            Withdraw
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="p-6 bg-white rounded-lg border border-slate-200 text-center text-slate-600">
            You haven't applied to any jobs yet.
            <a href="{% url 'job_list' %}" class="text-blue-600 hover:underline ml-1">Find jobs</a>
        </div>
    {% endif %}
</div>
{% endblock %}
